<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âõ¢ÈòüÂÜÖÈÉ®ÂØºËà™ | Dev Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/css/element-plus.css">
    
    <style>
        [v-cloak] { display: none; }
        
        /* Account Page Styles */
        .info-value.warning { color: #e6a23c; }
        .el-descriptions__label { color: #909399; font-weight: normal !important; }
        .el-descriptions__content { font-weight: normal; }
        .el-descriptions-item__container { padding: 10px 0; border-bottom: 1px solid #f0f2f5; }
        .el-descriptions-item__container:last-child { border-bottom: none; }
        .balance-amount { font-size: 14px; font-weight: normal; color: #409eff; }
        .toggle-raw { margin-top: 12px; text-align: center; }
        .transaction-table { margin-top: 16px; }
        .amount-debit { color: #f56c6c; font-weight: 600; }
        .amount-credit { color: #67c23a; font-weight: 600; }
        .json-viewer { background: #282c34; color: #abb2bf; padding: 16px; border-radius: 6px; font-family: monospace; font-size: 13px; max-height: 500px; overflow: auto; }

        /* Ëá™ÂÆö‰πâÁÆÄÂçïÁöÑ Toast ÊèêÁ§∫Âä®Áîª */
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(20px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }
        .toast {
            animation: fadeInOut 2s ease-in-out forwards;
        }
        
        /* Èº†Ê†áÊÇ¨ÂÅúÊòæÁ§∫Â§çÂà∂ÊèêÁ§∫ */
        .copy-hover:hover {
            background-color: #f1f5f9; /* slate-100 */
            cursor: pointer;
            border-radius: 4px;
            position: relative;
        }
        .copy-hover:active {
            background-color: #e2e8f0; /* slate-200 */
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans antialiased selection:bg-blue-100">

    <div id="app" v-cloak>
        <header class="bg-white border-b border-slate-200 sticky top-0 z-10 shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold">
                        D
                    </div>
                    <h1 class="text-xl font-bold text-slate-800 tracking-tight">Dev<span class="text-blue-600">Portal</span></h1>
                    <span class="px-2 py-0.5 rounded-full bg-slate-100 text-slate-500 text-xs font-medium border border-slate-200">Internal</span>
                </div>
                
                <div class="flex items-center gap-4">
                    <div v-if="isEditMode" class="flex items-center gap-3 animate-fade-in">
                        <span class="text-xs text-green-600 font-medium bg-green-50 px-2 py-1 rounded border border-green-100">
                            <i class="fa-solid fa-user-check mr-1"></i> <span>[[ currentAdminId ]]</span>
                        </span>
                        <button @click="saveConfig" class="text-sm bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded shadow-sm transition">
                            ‰øùÂ≠òÈÖçÁΩÆ
                        </button>
                        <button @click="exitEditMode" class="text-sm text-slate-500 hover:text-slate-700 px-2">
                            ÈÄÄÂá∫
                        </button>
                    </div>

                    <button v-else @click="requestAuth" class="text-slate-400 hover:text-blue-600 transition p-2" title="ÁÆ°ÁêÜÊ®°Âºè">
                        <i class="fa-solid fa-lock"></i>
                    </button>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-10">
            <el-tabs v-model="mainTab" type="border-card" class="bg-white shadow-sm rounded-lg min-h-[600px]">
                <!-- Tab 1: Workspace Resources -->
                <el-tab-pane label="Â∑•‰ΩúÂè∞ËµÑÊ∫ê" name="workspace">
                    <div class="p-4">
                        <section v-for="group in workspaceData" :key="group.id" class="mb-8">
                            <!-- 1. ÂàÜÁªÑÊ†áÈ¢ò -->
                            <div class="flex items-center justify-between mb-5 pb-2 border-b border-slate-200 group">
                                <div class="flex items-center gap-3">
                                    <i :class="[group.icon, group.color, 'text-xl']"></i>
                                    <h2 class="text-xl font-bold text-slate-800">[[ group.title ]]</h2>
                                    <span v-if="group.badge" :class="['px-2 py-0.5 text-xs font-bold rounded border', group.badgeColor]">[[ group.badge ]]</span>
                                </div>
                                <div v-if="isEditMode" class="opacity-100 transition-opacity flex gap-2">
                                    <button class="text-xs bg-slate-100 hover:bg-slate-200 text-slate-600 px-2 py-1 rounded">
                                        <i class="fa-solid fa-plus mr-1"></i>Ê∑ªÂä†ËµÑÊ∫ê
                                    </button>
                                    <button class="text-xs text-red-500 hover:bg-red-50 px-2 py-1 rounded">Âà†Èô§ÂàÜÁªÑ</button>
                                </div>
                            </div>

                            <!-- 2. Ê∏≤ÊüìÁ´ôÁÇπÈìæÊé• (Grid) -->
                            <div v-if="(group.type === 'links' ? group.items : (group.links || [])).length > 0 || isEditMode" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6">
                                <a v-for="item in (group.type === 'links' ? group.items : (group.links || []))" :href="item.url" target="_blank" class="relative block p-4 bg-white rounded-lg border border-slate-200 shadow-sm hover:shadow-md hover:border-blue-300 transition group/card">
                                    <button v-if="isEditMode" @click.prevent="alert('Âà†Èô§ÈìæÊé•')" class="absolute top-2 right-2 text-slate-300 hover:text-red-500 z-10"><i class="fa-solid fa-trash-can"></i></button>
                                    <div class="flex items-start gap-3">
                                        <div class="text-2xl text-slate-400 group-hover/card:text-blue-500 transition-colors mt-1">
                                            <i :class="item.icon"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-slate-800 text-sm group-hover/card:text-blue-600">[[ item.name ]]</h3>
                                            <p class="text-xs text-slate-500 mt-1 line-clamp-2">[[ item.desc ]]</p>
                                        </div>
                                    </div>
                                </a>
                                <!-- ÁºñËæëÊ®°Âºè‰∏ãÁöÑ‚ÄúÊ∑ªÂä†ÈìæÊé•‚ÄùÂç†‰ΩçÁ¨¶ -->
                                <button v-if="isEditMode" @click="alert('Ê∑ªÂä†ÈìæÊé•')" class="flex flex-col items-center justify-center p-4 rounded-lg border-2 border-dashed border-slate-200 text-slate-400 hover:border-blue-400 hover:text-blue-500 transition h-full min-h-[80px]">
                                    <i class="fa-solid fa-plus text-lg mb-1"></i>
                                    <span class="text-xs font-medium">Ê∑ªÂä†ÈìæÊé•</span>
                                </button>
                            </div>

                            <!-- 3. Ê∏≤ÊüìÊï∞ÊçÆÂ∫ìÂàóË°® (Table Style) -->
                            <div v-if="group.dbs && group.dbs.length > 0" class="bg-white border border-slate-200 rounded-lg shadow-sm overflow-hidden mb-6">
                                <div class="px-4 py-3 bg-slate-50 border-b border-slate-200 flex justify-between items-center">
                                    <h3 class="text-sm font-bold text-slate-700"><i class="fa-solid fa-database mr-2"></i>Êï∞ÊçÆÂ∫ìËµÑÊ∫ê</h3>
                                    <span class="text-xs text-slate-400">ÁÇπÂáªË°®Ê†ºÂÜÖÂÆπÂç≥ÂèØÂ§çÂà∂</span>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-left text-sm">
                                        <thead>
                                            <tr class="bg-white text-slate-500 border-b border-slate-100">
                                                <th class="px-4 py-2 font-medium w-1/4">ÂêçÁß∞</th>
                                                <th class="px-4 py-2 font-medium w-1/4">Host:Port</th>
                                                <th class="px-4 py-2 font-medium w-1/6">User</th>
                                                <th class="px-4 py-2 font-medium w-1/4">Password</th>
                                                <th v-if="isEditMode" class="px-4 py-2 font-medium text-right w-12">Êìç‰Ωú</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-slate-50">
                                            <tr v-for="db in group.dbs" class="hover:bg-slate-50 transition-colors">
                                                <td class="px-4 py-3">
                                                    <div class="flex items-center gap-2">
                                                        <i class="fa-solid fa-server text-slate-300"></i>
                                                        <span class="font-medium text-slate-700">[[ db.name ]]</span>
                                                    </div>
                                                </td>
                                                <td class="px-4 py-3 font-mono text-xs text-slate-600 copy-hover" @click="copyToClipboard(`${db.host}:${db.port}`)" title="ÁÇπÂáªÂ§çÂà∂">
                                                    [[ db.host ]]:[[ db.port ]]
                                                </td>
                                                <td class="px-4 py-3 font-mono text-xs text-slate-600 copy-hover" @click="copyToClipboard(db.user)" title="ÁÇπÂáªÂ§çÂà∂">
                                                    [[ db.user ]]
                                                </td>
                                                <td class="px-4 py-3 font-mono text-xs text-pink-600 bg-pink-50/50 rounded copy-hover select-all" @click="copyToClipboard(db.pass)" title="ÁÇπÂáªÂ§çÂà∂">
                                                    [[ db.pass ]]
                                                </td>
                                                <td v-if="isEditMode" class="px-4 py-3 text-right">
                                                    <button class="text-slate-400 hover:text-red-500 transition"><i class="fa-solid fa-trash-can"></i></button>
                                                </td>
                                            </tr>
                                            <tr v-if="isEditMode" class="bg-slate-50">
                                                <td colspan="5" class="px-4 py-2 text-center border-t border-dashed border-slate-200">
                                                    <button class="text-xs text-blue-600 hover:text-blue-800 font-medium py-1">
                                                        <i class="fa-solid fa-plus mr-1"></i>Ê∑ªÂä†Êï∞ÊçÆÂ∫ì
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </section>
                    </div>
                </el-tab-pane>

                <!-- Tab 2: Account Query -->
                <el-tab-pane label="Ê†∏ÂøÉË¥¶Êà∑Êü•ËØ¢" name="account">
                    <div class="p-4">
                        <el-tabs v-model="activeTab" type="card">
                            <!-- Ë¥¶Êà∑‰ø°ÊÅØÊü•ËØ¢Ê†áÁ≠æÈ°µ -->
                            <el-tab-pane label="Ë¥¶Êà∑‰ø°ÊÅØ" name="balance">
                                <el-form :model="balanceForm" inline>
                                    <el-form-item label="Ë¥¶Âè∑">
                                        <el-input 
                                            v-model="balanceForm.account" 
                                            placeholder="ËØ∑ËæìÂÖ•Ë¥¶Âè∑"
                                            clearable
                                            style="width: 240px">
                                        </el-input>
                                    </el-form-item>
                                    <el-form-item label="ÁéØÂ¢É">
                                        <el-select v-model="balanceForm.env" placeholder="ÈÄâÊã©ÁéØÂ¢É" style="width: 120px">
                                            <el-option label="SIT-A" value="sita"></el-option>
                                            <el-option label="SIT-B" value="sitb"></el-option>
                                            <el-option label="UAT" value="uat"></el-option>
                                        </el-select>
                                    </el-form-item>
                                    <el-form-item>
                                        <el-button @click="clearBalanceResult">Ê∏ÖÈô§</el-button>
                                        <el-button type="primary" @click="queryBalance" :loading="balanceLoading">
                                            Êü•ËØ¢
                                        </el-button>
                                    </el-form-item>
                                </el-form>
                                
                                <div v-if="balanceResult" class="result-card" style="padding-top: 0;">
                                    <!-- Ë¥¶Êà∑‰ø°ÊÅØÂ±ïÁ§∫ -->
                                    <div v-if="getAccountInfo(balanceResult)">
                                        <el-table :data="getAccountInfoRows()" stripe style="width: 100%" :show-header="false">
                                            <el-table-column prop="label" label="Â≠óÊÆµ" width="420">
                                                <template #default="scope">
                                                    <span v-html="scope.row.label"></span>
                                                </template>
                                            </el-table-column>
                                            <el-table-column prop="value" label="ÂÄº">
                                                <template #default="scope">
                                                    <span v-if="scope.row.isHtml" v-html="scope.row.value"></span>
                                                    <span v-else>[[ scope.row.value ]]</span>
                                                </template>
                                            </el-table-column>
                                        </el-table>

                                        <div class="toggle-raw">
                                            <el-button text @click="showRawBalance = !showRawBalance">
                                                <span v-text="showRawBalance ? 'ÈöêËóè' : 'Êü•Áúã'"></span>ÂéüÂßãÊï∞ÊçÆ
                                            </el-button>
                                        </div>
                                    </div>
                                    
                                    <pre v-if="showRawBalance" class="json-viewer" v-text="formatJson(balanceResult)"></pre>
                                    <pre v-if="!getAccountInfo(balanceResult) && balanceResult" class="json-viewer" v-text="formatJson(balanceResult)"></pre>
                                </div>
                            </el-tab-pane>
                            
                            <!-- ‰∫§ÊòìÊòéÁªÜÊü•ËØ¢Ê†áÁ≠æÈ°µ -->
                            <el-tab-pane label="‰∫§ÊòìÊòéÁªÜ" name="detail">
                                <el-form :model="detailForm" inline>
                                    <el-form-item label="Ë¥¶Âè∑">
                                        <el-input 
                                            v-model="detailForm.account" 
                                            placeholder="ËØ∑ËæìÂÖ•Ë¥¶Âè∑"
                                            clearable
                                            style="width: 240px">
                                        </el-input>
                                    </el-form-item>
                                    <el-form-item label="ÁéØÂ¢É">
                                        <el-select v-model="detailForm.env" placeholder="ÈÄâÊã©ÁéØÂ¢É" style="width: 120px">
                                            <el-option label="SIT-A" value="sita"></el-option>
                                            <el-option label="SIT-B" value="sitb"></el-option>
                                            <el-option label="UAT" value="uat"></el-option>
                                        </el-select>
                                    </el-form-item>
                                    <el-form-item label="Ê†∏ÂøÉÊó•Êúü">
                                        <el-date-picker
                                            v-model="detailForm.beginDate"
                                            type="date"
                                            placeholder="ÂºÄÂßãÊó•Êúü"
                                            value-format="YYYY-MM-DD"
                                            style="width: 140px">
                                        </el-date-picker>
                                    </el-form-item>
                                    <el-form-item label="Ëá≥">
                                        <el-date-picker
                                            v-model="detailForm.endDate"
                                            type="date"
                                            placeholder="ÁªìÊùüÊó•Êúü"
                                            value-format="YYYY-MM-DD"
                                            style="width: 140px">
                                        </el-date-picker>
                                    </el-form-item>
                                    <el-form-item>
                                        <el-button @click="clearDetailResult">Ê∏ÖÈô§</el-button>
                                        <el-button type="primary" @click="queryDetail" :loading="detailLoading">
                                            Êü•ËØ¢
                                        </el-button>
                                    </el-form-item>
                                </el-form>
                                
                                <div v-if="detailResult" class="result-card">
                                    <!-- ‰∫§ÊòìÊòéÁªÜÂ±ïÁ§∫ -->
                                    <div v-if="getTransactionList(detailResult) && getTransactionList(detailResult).length > 0" class="transaction-table">
                                        
                                        <el-table 
                                            :data="paginatedData" 
                                            stripe 
                                            style="width: 100%"
                                            :default-sort="{prop: 'StdTxnDt', order: 'descending'}">
                                            <el-table-column prop="StdTxnDt" label="Ê†∏ÂøÉÊó•Êúü" sortable></el-table-column>
                                            <el-table-column prop="BckInf1" label="Ëá™ÁÑ∂Êó•Êúü">
                                                <template #default="scope">
                                                    <span v-text="formatDate(scope.row.BckInf1)"></span>
                                                </template>
                                            </el-table-column>
                                            <el-table-column prop="BckInf1" label="‰∫§ÊòìÊó∂Èó¥">
                                                <template #default="scope">
                                                    <span v-text="formatTime(scope.row.BckInf1)"></span>
                                                </template>
                                            </el-table-column>
                                            
                                            <el-table-column prop="TxnAmt" label="‰∫§ÊòìÈáëÈ¢ù" align="right">
                                                <template #default="scope">
                                                    <span :class="scope.row.DbCrFlg === 'C' ? 'amount-credit' : 'amount-debit'">
                                                        <span v-text="(scope.row.DbCrFlg === 'C' ? '+' : '-') + formatCurrency(scope.row.TxnAmt)"></span>
                                                    </span>
                                                </template>
                                            </el-table-column>
                                            <el-table-column prop="AcctBal" label="‰ΩôÈ¢ù" align="right">
                                                <template #default="scope">
                                                    <span v-text="formatCurrency(scope.row.AcctBal)"></span>
                                                </template>
                                            </el-table-column>
                                            <el-table-column prop="OppAcctNm" label="ÂØπÊñπÊà∑Âêç" min-width="200"></el-table-column>
                                            <el-table-column prop="OppAcctNo" label="ÂØπÊñπË¥¶Âè∑"></el-table-column>
                                            <el-table-column prop="InstChinNm" label="ÂØπÊñπË°åÂêç"></el-table-column>
                                            <el-table-column prop="Remark" label="Â§áÊ≥®" show-overflow-tooltip></el-table-column>
                                            <el-table-column prop="SmyDsc" label="ÊëòË¶Å"></el-table-column>
                                        </el-table>

                                        <div style="margin-top: 16px; display: flex; justify-content: flex-end;">
                                            <el-pagination
                                                v-if="getTransactionList(detailResult).length > 0"
                                                @size-change="handleSizeChange"
                                                @current-change="handleCurrentChange"
                                                :current-page="currentPage"
                                                :page-sizes="[10, 20, 50, 100]"
                                                :page-size="pageSize"
                                                layout="total, sizes, prev, pager, next, jumper"
                                                :total="getTransactionList(detailResult).length">
                                            </el-pagination>
                                        </div>
                                        
                                        <div class="toggle-raw">
                                            <el-button text @click="showRawDetail = !showRawDetail">
                                                <span v-text="showRawDetail ? 'ÈöêËóè' : 'Êü•Áúã'"></span>ÂéüÂßãÊï∞ÊçÆ
                                            </el-button>
                                        </div>
                                    </div>
                                    
                                    <div v-else-if="getTransactionList(detailResult) === null && !detailLoading">
                                         <pre class="json-viewer" v-text="formatJson(detailResult)"></pre>
                                    </div>

                                    <div v-else class="loading">
                                        <p v-if="detailLoading">Ê≠£Âú®Âä†ËΩΩ...</p>
                                        <p v-else>Ê≤°ÊúâÊâæÂà∞‰∫§ÊòìËÆ∞ÂΩï„ÄÇ</p>
                                    </div>
                                </div>
                            </el-tab-pane>
                        </el-tabs>
                    </div>
                </el-tab-pane>
            </el-tabs>
        </main>
    </div>

    <script src="/static/js/vendor/vue.global.js"></script>
    <script src="/static/js/vendor/element-plus.js"></script>
    <script src="/static/js/vendor/axios.min.js"></script>
    <script>
        const { createApp, ref, computed, onMounted } = Vue;
        const ACCOUNT_API = '/api/v1/account';

        const app = createApp({
            setup() {
                // ================= Workspace Logic =================
                const mainTab = ref('workspace');
                const workspaceData = ref([]);
                const isEditMode = ref(false);
                const currentAdminId = ref(null);
                const ALLOWED_IDS = ["1001", "1002", "admin"];

                const requestAuth = () => {
                    const input = prompt("ËØ∑ËæìÂÖ•Â∑•Âè∑ (Employee ID) ‰ª•ËøõÂÖ•ÁºñËæëÊ®°ÂºèÔºö\n(ÊµãËØïÂèØÁî®: 1001, admin)");
                    if (input === null) return;
                    if (ALLOWED_IDS.includes(input.trim())) {
                        isEditMode.value = true;
                        currentAdminId.value = input.trim();
                        ElementPlus.ElMessage.success(`Ê¨¢Ëøé, ${currentAdminId.value}„ÄÇÂ∑≤ËøõÂÖ•ÁºñËæëÊ®°Âºè„ÄÇ`);
                    } else {
                        alert("‚ùå È™åËØÅÂ§±Ë¥•ÔºöÂ∑•Âè∑Êó†ÁºñËæëÊùÉÈôê„ÄÇ");
                    }
                };

                const exitEditMode = () => {
                    isEditMode.value = false;
                    currentAdminId.value = null;
                };

                const saveConfig = () => {
                    ElementPlus.ElMessage.success("üíæ ÈÖçÁΩÆÂ∑≤‰øùÂ≠ò (Ê®°ÊãüÂêéÁ´ØÂÜôÂÖ•)");
                    exitEditMode();
                };

                const copyToClipboard = (text) => {
                    navigator.clipboard.writeText(text).then(() => {
                        ElementPlus.ElMessage.success(`Â∑≤Â§çÂà∂: ${text}`);
                    }).catch(err => {
                        console.error('Â§çÂà∂Â§±Ë¥•', err);
                    });
                };

                // ================= Account Logic =================
                const activeTab = ref('balance');
                const balanceForm = ref({ account: '', env: 'sitb' });
                const balanceResult = ref(null);
                const balanceLoading = ref(false);
                const showRawBalance = ref(false);

                const detailForm = ref({ account: '', env: 'sitb', beginDate: '', endDate: '' });
                const detailResult = ref(null);
                const detailLoading = ref(false);
                const showRawDetail = ref(false);

                const currentPage = ref(1);
                const pageSize = ref(10);

                const queryBalance = async () => {
                    if (!balanceForm.value.account) {
                        ElementPlus.ElMessage.warning('ËØ∑ËæìÂÖ•Ë¥¶Âè∑');
                        return;
                    }
                    balanceLoading.value = true;
                    balanceResult.value = null;
                    try {
                        const response = await axios.post(`${ACCOUNT_API}/balance-query`, {
                            account: balanceForm.value.account,
                            env: balanceForm.value.env
                        });
                        balanceResult.value = response.data;
                        ElementPlus.ElMessage.success('Êü•ËØ¢ÊàêÂäü');
                    } catch (error) {
                        console.error('Balance query error:', error);
                        ElementPlus.ElMessage.error(error.response?.data?.error || 'Êü•ËØ¢Â§±Ë¥•');
                        balanceResult.value = { error: error.response?.data || error.message };
                    } finally {
                        balanceLoading.value = false;
                    }
                };

                const queryDetail = async () => {
                    if (!detailForm.value.account) {
                        ElementPlus.ElMessage.warning('ËØ∑ËæìÂÖ•Ë¥¶Âè∑');
                        return;
                    }
                    detailLoading.value = true;
                    detailResult.value = null;
                    currentPage.value = 1;
                    try {
                        const payload = {
                            account: detailForm.value.account,
                            env: detailForm.value.env,
                            begTms: 0,
                            quryTms: 9999 
                        };
                        if (detailForm.value.beginDate) payload.beginDate = detailForm.value.beginDate.replace(/-/g, '');
                        if (detailForm.value.endDate) payload.endDate = detailForm.value.endDate.replace(/-/g, '');

                        const response = await axios.post(`${ACCOUNT_API}/query-detail`, payload);
                        detailResult.value = response.data;
                        ElementPlus.ElMessage.success('Êü•ËØ¢ÊàêÂäü');
                    } catch (error) {
                        console.error('Detail query error:', error);
                        ElementPlus.ElMessage.error(error.response?.data?.error || 'Êü•ËØ¢Â§±Ë¥•');
                        detailResult.value = { error: error.response?.data || error.message };
                    } finally {
                        detailLoading.value = false;
                    }
                };

                const clearBalanceResult = () => balanceResult.value = null;
                const clearDetailResult = () => detailResult.value = null;
                const formatJson = (obj) => JSON.stringify(obj, null, 2);
                const getAccountInfo = (result) => result?.data?.service?.BODY?.array?.BtchAcctInfQuryArray;
                
                const getAccountInfoRows = () => {
                    const info = getAccountInfo(balanceResult.value);
                    if (!info) return [];
                    return [
                        { label: 'Ë¥¶Êà∑', value: info.CstAcctNo, isHtml: false },
                        { label: 'Êà∑Âêç', value: info.AcctNm, isHtml: false },
                        { label: 'Ë¥¶Êà∑‰ΩôÈ¢ù', value: `<span style="color: #409eff;">${formatCurrency(info.CrnAcctBal)}</span>`, isHtml: true },
                        { label: 'ÂèØÁî®‰ΩôÈ¢ù', value: `<span style="color: #67c23a;">${formatCurrency(info.UseBal)}</span>`, isHtml: true },
                        { label: 'Ë¥¶Êà∑Á±ªÂûã <span style="color: #909399; font-size: 12px; margin-left: 8px;">(1=Ê¥ªÊúü 2=ÂÆöÊúü 4=ÈÄöÁü•Â≠òÊ¨æ)</span>', value: getAccountCharText(info.AcctChar), isHtml: false },
                        { label: 'Ë¥¶Êà∑ÊÄßË¥® <span style="color: #909399; font-size: 12px; margin-left: 8px;">(1=‰∏™‰∫∫ 2=ÂØπÂÖ¨ 3=ÂÜÖÈÉ®)</span>', value: getAccountKindText(info.AcctKnd), isHtml: false },
                        { label: 'ÂÆ¢Êà∑ÁßçÁ±ª <span style="color: #909399; font-size: 12px; margin-left: 8px;">(1=‰∏™‰∫∫ 2=ÂØπÂÖ¨ 3=ÂÜÖÈÉ®)</span>', value: getCustomerKindText(info.CoreCstKnd), isHtml: false },
                        { label: 'Â∏ÅÁßç', value: info.CcyNo, isHtml: false },
                        { label: 'ÂºÄÊà∑Êó•Êúü', value: info.OpnAcctDt, isHtml: false },
                        { label: 'ÂºÄÊà∑Êú∫ÊûÑ', value: info.OpnAcctInst, isHtml: false },
                        { label: 'Âà©Áéá (%)', value: info.IntRate, isHtml: false },
                        { label: 'Ëµ∑ÊÅØÊó•Êúü', value: info.IntBegDt, isHtml: false },
                        { label: 'ÊúÄÂêé‰∫§ÊòìÊó•', value: info.LastBsnDt, isHtml: false },
                        { label: 'Â≠òÊ¨æÁ±ªÂûã <span style="color: #909399; font-size: 12px; margin-left: 8px;">(D=Ê¥ªÊúü T=ÂÆöÊúü N=ÈÄöÁü•)</span>', value: getDepositTypeText(info.DepPrdTp), isHtml: false },
                        { label: 'ÊîØÂèñÊñπÂºè <span style="color: #909399; font-size: 12px; margin-left: 8px;">(1=‰∏ÄÊ¨°ÊÄß 2=ÂàÜÊ¨° 3=ÈÉ®ÂàÜ 4=ÈöèÊó∂)</span>', value: getDrawModeText(info.DrawMode), isHtml: false },
                        { label: 'Ê†∏ÂøÉË¥¶Êà∑Áä∂ÊÄÅ <span style="color: #909399; font-size: 12px; margin-left: 8px;">(0=Ê≠£Â∏∏ 1=ÂÜªÁªì 2=ÊåÇÂ§± 3=ÈîÄÊà∑)</span>', value: `<span class="el-tag el-tag--${info.CoreAcctSt === '0' ? 'success' : 'warning'} el-tag--small">${getCoreAcctStatusText(info.CoreAcctSt)}</span>`, isHtml: true },
                        { label: 'Ë¥¶Êà∑Áä∂ÊÄÅ <span style="color: #909399; font-size: 12px; margin-left: 8px;">(Y=Ê≠£Â∏∏ N=ÈùûÊ≠£Â∏∏)</span>', value: `<span class="el-tag el-tag--${info.AcctActvFlg === 'Y' ? 'success' : 'danger'} el-tag--small">${getAccountStatusText(info.AcctActvFlg)}</span>`, isHtml: true }
                    ];
                };

                const formatCurrency = (amount) => !amount ? '0.00' : parseFloat(amount).toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                const getAccountStatusText = (flag) => flag === 'Y' ? 'Ê≠£Â∏∏' : 'ÈùûÊ≠£Â∏∏';
                const getAccountCharText = (char) => ({'1': 'Ê¥ªÊúüË¥¶Êà∑', '2': 'ÂÆöÊúüË¥¶Êà∑', '3': 'Ê¥ªÊúüË¥¶Êà∑', '4': 'ÈÄöÁü•Â≠òÊ¨æË¥¶Êà∑'})[char] || char;
                const getAccountKindText = (kind) => ({'1': '‰∏™‰∫∫Ë¥¶Êà∑', '2': 'ÂØπÂÖ¨Ë¥¶Êà∑', '3': 'ÂÜÖÈÉ®Ë¥¶Êà∑'})[kind] || kind;
                const getCustomerKindText = (kind) => ({'1': '‰∏™‰∫∫ÂÆ¢Êà∑', '2': 'ÂØπÂÖ¨ÂÆ¢Êà∑', '3': 'ÂÜÖÈÉ®ÂÆ¢Êà∑'})[kind] || kind;
                const getDepositTypeText = (type) => ({'D': 'Ê¥ªÊúüÂ≠òÊ¨æ', 'T': 'ÂÆöÊúüÂ≠òÊ¨æ', 'N': 'ÈÄöÁü•Â≠òÊ¨æ'})[type] || type;
                const getDrawModeText = (mode) => ({'1': '‰∏ÄÊ¨°ÊÄßÊîØÂèñ', '2': 'ÂàÜÊ¨°ÊîØÂèñ', '3': 'ÈÉ®ÂàÜÊîØÂèñ', '4': 'ÈöèÊó∂ÊîØÂèñ'})[mode] || mode;
                const getCoreAcctStatusText = (status) => ({'0': 'Ê≠£Â∏∏', '1': 'ÂÜªÁªì', '2': 'ÊåÇÂ§±', '3': 'ÈîÄÊà∑'})[status] || status;
                const getTransactionList = (result) => {
                    const list = result?.data?.service?.BODY?.array?.TxnDtlInfArray;
                    return Array.isArray(list) ? list : null;
                };

                const paginatedData = computed(() => {
                    const list = getTransactionList(detailResult.value);
                    if (!list) return [];
                    const start = (currentPage.value - 1) * pageSize.value;
                    const end = start + pageSize.value;
                    return list.slice(start, end);
                });

                const handleSizeChange = (val) => { pageSize.value = val; currentPage.value = 1; };
                const handleCurrentChange = (val) => currentPage.value = val;
                const formatDate = (timeStr) => {
                    if (!timeStr) return '';
                    const match = timeStr.match(/^(\d{2}:\d{2}:\d{2})(\d{4}-\d{2}-\d{2})$/);
                    return match ? match[2] : timeStr;
                };
                const formatTime = (timeStr) => {
                    if (!timeStr) return '';
                    const match = timeStr.match(/^(\d{2}:\d{2}:\d{2})(\d{4}-\d{2}-\d{2})$/);
                    return match ? match[1] : timeStr;
                };

                onMounted(() => {
                    fetch('/api/v1/workspace/sites')
                        .then(response => response.json())
                        .then(data => {
                            workspaceData.value = data;
                        })
                        .catch(error => {
                            console.error('Error fetching workspace sites:', error);
                            ElementPlus.ElMessage.error('Âä†ËΩΩÂ∑•‰ΩúÂè∞Êï∞ÊçÆÂ§±Ë¥•');
                        });
                });

                return {
                    mainTab, workspaceData, isEditMode, currentAdminId, requestAuth, exitEditMode, saveConfig, copyToClipboard,
                    activeTab, balanceForm, balanceResult, balanceLoading, showRawBalance,
                    detailForm, detailResult, detailLoading, showRawDetail,
                    currentPage, pageSize, paginatedData,
                    queryBalance, queryDetail, clearBalanceResult, clearDetailResult,
                    formatJson, getAccountInfo, getAccountInfoRows, formatCurrency,
                    getAccountStatusText, getAccountCharText, getAccountKindText, getCustomerKindText,
                    getDepositTypeText, getDrawModeText, getCoreAcctStatusText, getTransactionList,
                    handleSizeChange, handleCurrentChange, formatDate, formatTime
                };
            }
        });
        app.config.compilerOptions.delimiters = ['[[', ']]'];
        app.use(ElementPlus).mount('#app');
    </script>
</body>
</html>